{% load static %}

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    
    {# CSS Stylesheets #}
    <link rel="stylesheet" href="{% static 'course/css/home.css' %}">
    <link rel="stylesheet" href="{% static 'course/css/footer.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="course-details-container" data-course-id="{{ course.id }}">
        {# Enhanced Hero Section with Dynamic Elements #}
        <div class="hero-section">
            <div class="hero-background">
                <div class="tech-pattern"></div>
                <div class="gradient-overlay"></div>
                <div class="animated-shapes">
                    <div class="shape shape-1"></div>
                    <div class="shape shape-2"></div>
                    <div class="shape shape-3"></div>
                </div>
            </div>
            
            <div class="hero-content">
                <div class="course-header">
                    <div class="course-category">
                        <i class="fas fa-brain"></i>
                        <span>Data Science & KI</span>
                    </div>
                    
                    <h1>{{ course.title }}</h1>
                    <p class="course-tagline">Entdecken Sie die Welt der Data Science und KI</p>
                    
 

                    <div class="course-features">
                        <div class="feature-tag">
                            <i class="fas fa-laptop-code"></i>
                            Praktische Projekte
                        </div>
                        <div class="feature-tag">
                            <i class="fas fa-comments"></i>
                            Experten-Support
                        </div>
                        <div class="feature-tag">
                            <i class="fas fa-medal"></i>
                            Zertifizierung
                        </div>
                    </div>
                    
                    <div class="course-actions">
                        {% if is_enrolled %}
                            {% if course.max_members == 1 %}
                                <a href="{% url 'course:course_overview' course.id %}" class="action-btn primary">
                                    <i class="fas fa-rocket"></i>
                                    <span>Kurs starten</span>
                                    <i class="fas fa-arrow-right"></i>
                                </a>
                            {% else %}
                                {% if user_group %}
                                    <a href="{% url 'course:course_overview' course.id %}" class="action-btn primary">
                                        <i class="fas fa-rocket"></i>
                                        <span>Kurs starten</span>
                                        <i class="fas fa-arrow-right"></i>
                                    </a>
                                {% else %}
                                    <button class="action-btn secondary" onclick="openGroupPopup()">
                                        <i class="fas fa-users"></i>
                                        <span>Gruppe beitreten</span>
                                    </button>
                                {% endif %}
                            {% endif %}
                        {% else %}
                            <button class="action-btn enroll" onclick="openEnrollmentModal()">
                                <i class="fas fa-sign-in-alt"></i>
                                <span>Jetzt einschreiben</span>
                            </button>
                        {% endif %}
                        
                        {% if is_instructor %}
                            <a href="{% url 'course:manage_course' course.id %}" class="action-btn instructor">
                                <i class="fas fa-cog"></i>
                                <span>Kursverwaltung</span>
                            </a>
                            <a href="{% url 'course:submissions_dashboard' %}" class="action-btn instructor">
                                <i class="fas fa-chart-bar"></i>
                                <span>Abgaben</span>
                            </a>
                        {% endif %}
                        
                        {% if request.user.is_superuser %}
                            <a href="{% url 'course:admin_dashboard' %}" class="action-btn admin">
                                <i class="fas fa-crown"></i>
                                <span>Admin-Bereich</span>
                            </a>
                        {% endif %}
                        <a href="{% url 'shibboleth:logout' %}" class="action-btn logout">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Abmelden</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        {# Modern Tab Navigation #}
        <nav class="course-tabs">
            <button class="tab-button active" data-tab="info">
                <i class="fas fa-info-circle"></i>
                Modulübersicht
            </button>
            <button class="tab-button" data-tab="group">
                <i class="fas fa-users"></i>
                Teaminfo
            </button>
            <button class="tab-button" data-tab="details">
                <i class="fas fa-clipboard-list"></i>
                Moduldetails
            </button>
        </nav>

        {# Tab Content Sections #}
        <div class="tab-content active" id="info">
            <div class="content-card description-card">
                <div class="card-header">
                    <h2>Über dieses Modul</h2>
                    <div class="tech-badge">Data Science & KI</div>
                </div>
                <div class="prose-content">
                    {{ course.description|linebreaks }}
                </div>
                <div class="course-highlights">
                    <div class="highlight-item">
                        <i class="fas fa-clock"></i>
                        <span>Flexibles Lernen</span>
                    </div>
                    <div class="highlight-item">
                        <i class="fas fa-laptop-code"></i>
                        <span>Praktische Übungen</span>
                    </div>
                    <div class="highlight-item">
                        <i class="fas fa-certificate"></i>
                        <span>Zertifizierung</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="group">
            <div class="content-card">
                {% if user_group %}
                    <div class="group-dashboard">
                        <div class="group-header">
                            <h2>Ihr Team</h2>
                            <span class="group-badge">Team {{ user_group.id }}</span>
                            <button class="action-btn secondary email-all" onclick="emailAllMembers()">
                                <i class="fas fa-envelope"></i>
                                Team-Email
                            </button>
                        </div>
                        <div class="members-grid">
                            {% for member in user_group.members.all %}
                                <div class="member-card">
                                    <div class="member-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="member-info">
                                        <h4>{{ member.first_name }} {{ member.last_name }}</h4>
                                        <div class="member-contact">
                                            <a href="mailto:{{ member.email }}" class="member-email">
                                                <i class="fas fa-envelope"></i>
                                                {{ member.email }}
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <p>Sie sind noch kein Mitglied eines Teams</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="tab-content" id="details">
            <div class="content-card">
                <div class="details-grid">
                    <div class="detail-card">
                        <i class="fas fa-users"></i>
                        <div class="detail-info">
                            <h4>Maximale Gruppengröße</h4>
                            <span class="detail-value">{{ course.max_members }}</span>
                        </div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-calendar-alt"></i>
                        <div class="detail-info">
                            <h4>Startdatum</h4>
                            <span class="detail-value">{{ course.start_date|date:"d.m.Y" }}</span>
                        </div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-flag-checkered"></i>
                        <div class="detail-info">
                            <h4>Enddatum</h4>
                            <span class="detail-value">{{ course.end_date|date:"d.m.Y" }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {# Group Join Modal #}
        <div id="groupPopup" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Team beitreten</h3>
                    <button class="close-btn" onclick="closeGroupPopup()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="search-group">
                        <div class="search-input-wrapper">
                            <i class="fas fa-search"></i>
                            <input type="text" id="groupSearchInput" placeholder="Team suchen...">
                        </div>
                    </div>
                    <div id="searchResults" class="search-results">
                        <!-- Teams will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        {# Enrollment Modal #}
        <div id="enrollmentModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Kurseinschreibung</h3>
                    <button class="close-btn" onclick="closeEnrollmentModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="enrollmentKeyForm" class="enrollment-form">
                        <p>Bitte geben Sie erst den gültigen Einschreibeschlüssel ein. Dieser ist identisch zum Einschreibeschlüssel des zugeordneten Moodle-Kurses!</p>
                        <div class="form-group">
                            <label for="enrollmentKey">Einschreibeschlüssel</label>
                            <input type="text" id="enrollmentKey" name="enrollment_key" required>
                        </div>
                        <div id="enrollmentError" class="error-message" style="display: none;"></div>
                        <div class="form-actions">
                            <button type="button" class="action-btn primary" onclick="submitEnrollment()">
                                <i class="fas fa-check"></i>
                                Einschreiben
                            </button>
                        </div>
                    </div>
                    <div id="groupSelectionForm" style="display: none;">
                        <p>Bitte wählen Sie ein Team aus, bevor Sie den Kurs starten können.</p>
                        <div id="availableGroups" class="groups-container"></div>
                    </div>
                </div>
            </div>
        </div>

        {# Contact Section #}
        <div class="contact-section">
            <div class="content-card">
                <div class="contact-content">
                    <h3>Hilfe benötigt?</h3>
                    <p>Bei Fragen oder wenn Sie Unterstützung benötigen, kontaktieren Sie bitte den Infopunkt.</p>
                    <button class="action-btn contact" onclick="openTicketModal()">
                        <i class="fas fa-envelope"></i>
                        Support Anfrage
                    </button>
                </div>
            </div>
        </div>

        {# Ticket Form Modal #}
        <div id="ticketModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Neue Anfrage erstellen</h3>
                    <button class="close-btn" onclick="closeTicketModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="ticketForm" class="ticket-form">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="ticketSubject">Betreff</label>
                            <input type="text" id="ticketSubject" name="subject" required>
                        </div>
                        <div class="form-group">
                            <label for="ticketDescription">Beschreibung</label>
                            <textarea id="ticketDescription" name="description" rows="5" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="ticketImage">Bild hinzufügen (optional)</label>
                            <div class="file-upload-wrapper">
                                <input type="file" id="ticketImage" name="image" accept="image/*">
                                <div class="file-preview"></div>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="action-btn primary">
                                <i class="fas fa-paper-plane"></i>
                                Absenden
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {# JavaScript #}
    <script src="{% static 'course/js/home.js' %}"></script>
    
    {% include 'course/footer.html' %}
</body>
</html>
