{% extends "course/editcourse/management_base.html" %}
{% load static %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'course/css/pages/manage-settings.css' %}">
{% endblock %}

{% block management_content %}
<div class="settings-container">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h2 class="h4 mb-4">Kurseinstellungen</h2>
                    
                    <form id="courseSettingsForm" method="post">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="courseTitle" class="form-label">Kurstitel</label>
                            <input type="text" class="form-control" id="courseTitle" name="title" 
                                   value="{{ course.title }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="courseDescription" class="form-label">Kursbeschreibung</label>
                            <textarea class="form-control" id="courseDescription" name="description" 
                                      rows="4">{{ course.description }}</textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="maxMembers" class="form-label">Maximale Gruppenmitglieder</label>
                            <input type="number" class="form-control" id="maxMembers" name="max_members" 
                                   value="{{ course.max_members }}" min="1" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="difficultyLevel" class="form-label">Schwierigkeitsgrad</label>
                            <select class="form-select" id="difficultyLevel" name="difficulty_level">
                                <option value="1" {% if course.difficulty_level == 1 %}selected{% endif %}>Anfänger</option>
                                <option value="2" {% if course.difficulty_level == 2 %}selected{% endif %}>Fortgeschritten</option>
                                <option value="3" {% if course.difficulty_level == 3 %}selected{% endif %}>Experte</option>
                                <option value="4" {% if course.difficulty_level == 4 %}selected{% endif %}>Profi</option>
                                <option value="5" {% if course.difficulty_level == 5 %}selected{% endif %}>Demo</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="enrollmentKey" class="form-label">Einschreibeschlüssel</label>
                            <input type="text" class="form-control" id="enrollmentKey" name="enrollment_key" 
                                   value="{{ course.enrollment_key|default:'' }}" 
                                   placeholder="z.B. databrix2023">
                            <small class="text-muted">Dieser Schlüssel wird für die Kurseinschreibung benötigt und sollte mit dem Moodle-Einschreibeschlüssel identisch sein.</small>
                        </div>
                        <div class="mb-3">
                            <label for="courseStartDate" class="form-label">Kurs-Startdatum</label>
                            <input type="date" class="form-control" id="courseStartDate" name="start_date" 
                                   value="{{ course.start_date|date:'Y-m-d' }}">
                        </div>
                        <div class="mb-3">
                            <label for="courseEndDate" class="form-label">Kurs-Enddatum (Abgabefrist)</label>
                            <input type="date" class="form-control" id="courseEndDate" name="end_date" 
                                   value="{{ course.end_date|date:'Y-m-d' }}">
                            <small class="text-muted">Nach diesem Datum können Studierende keine Übungen mehr einreichen. Leer lassen für unbegrenzte Einreichungen.</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="isPublished" 
                                       name="is_published" {% if course.is_published %}checked{% endif %}>
                                <label class="form-check-label" for="isPublished">
                                    Kurs veröffentlichen
                                </label>
                            </div>
                            <small class="text-muted">Wenn veröffentlicht, können sich Studierende für diesen Kurs einschreiben.</small>
                        </div>
                        
                        <hr class="my-4">
                        
                        <h4 class="mb-3">JupyterLab-Umgebung</h4>
                        <div class="mb-3">
                            <label for="jupyterImage" class="form-label">JupyterLab Image</label>
                            <div class="input-group">
                                <select class="form-select" id="jupyterImage" name="jupyterlab_image">
                                    <option value="">Bitte wählen...</option>
                                    {% for image in available_images %}
                                    <option value="{{ image.image_name }}" {% if course.jupyterlab_image.image_name == image.image_name %}selected{% endif %}>{{ image.image_name }}</option>
                                    {% endfor %}
                                    {% if course.jupyterlab_image and course.jupyterlab_image not in available_images %}
                                    <option value="{{ course.jupyterlab_image.image_name }}" selected>{{ course.jupyterlab_image.image_name }}</option>
                                    {% endif %}
                                </select>
                                <button type="button" class="btn btn-outline-secondary" id="addCustomImageBtn">
                                    <i class="bi bi-plus"></i> Neu
                                </button>
                            </div>
                            <small class="text-muted">Wählen Sie ein Docker Hub Image für die JupyterLab-Umgebung</small>
                        </div>

                        <div class="mb-3">
                            <label for="domainName" class="form-label">Virtuelle Maschine Domain</label>
                            <div class="input-group">
                                <select class="form-select" id="domainName" name="domain_name">
                                    <option value="">Bitte wählen...</option>
                                    {% for domain in available_domains %}
                                    <option value="{{ domain }}" {% if course.domain_name == domain %}selected{% endif %}>{{ domain }}</option>
                                    {% endfor %}
                                    {% if course.domain_name and course.domain_name not in available_domains %}
                                    <option value="{{ course.domain_name }}" selected>{{ course.domain_name }}</option>
                                    {% endif %}
                                </select>
                                <button type="button" class="btn btn-outline-secondary" id="addCustomDomainBtn">
                                    <i class="bi bi-plus"></i> Neu
                                </button>
                            </div>
                            <small class="text-muted">Wählen Sie einen Domainnamen, unter dem JupyterHub gehostet wird (ohne http/https)</small>
                        </div>
                        
                        <div class="d-flex justify-content-end">
                            <button type="submit" class="btn btn-primary">Änderungen speichern</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for adding custom JupyterLab image -->
<div class="modal fade" id="addImageModal" tabindex="-1" aria-labelledby="addImageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addImageModalLabel">Neues JupyterLab Image hinzufügen</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="customImageName" class="form-label">Docker Image Name</label>
                    <input type="text" class="form-control" id="customImageName" placeholder="z.B. jupyter/datascience-notebook:latest">
                    <div id="customImageNameFeedback" class="invalid-feedback">
                        Bitte geben Sie einen gültigen Docker-Image-Namen ein.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                <button type="button" class="btn btn-primary" id="saveCustomImage">Hinzufügen</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for adding custom domain -->
<div class="modal fade" id="addDomainModal" tabindex="-1" aria-labelledby="addDomainModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addDomainModalLabel">Neue Domain hinzufügen</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="customDomainName" class="form-label">Domain Name</label>
                    <input type="text" class="form-control" id="customDomainName" placeholder="z.B. jupyter.example.com">
                    <div id="customDomainNameFeedback" class="invalid-feedback">
                        Bitte geben Sie einen gültigen Domainnamen ein.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                <button type="button" class="btn btn-primary" id="saveCustomDomain">Hinzufügen</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script src="{% static 'course/js/manage-settings.js' %}"></script>
{% endblock %} 